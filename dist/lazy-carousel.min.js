angular.module("rl.lazy-carousel",[]).controller("lazyCarouselController",["$scope","itemService",function(a,b){a.currentSlide=1,a.stopLazy=!1,b.get(a.source).then(function(b){a.items=b.data.items,a.limit=b.data.items.length,a.$broadcast("sourceLoaded")},function(){alert("problem to loading contents! try later! :(")})}]).directive("lazyCarousel",["$window","$timeout","itemService","$q",function(a,b,c,d){return{scope:{source:"@source"},controller:"lazyCarouselController",link:function(c,e){c.wrapper=$(e).find(".lazy-caousel-wrapper"),c.overflow=$(e).find(".lazy-carousel-overflow"),c.container=$(e).find(".lazy-carousel"),c.nextArrow=$(e).find(".lazy-next"),c.prevArrow=$(e).find(".lazy-prev");var g={init:function(){g.setDimension(),b(function(){g.renderImage(c.items[c.currentSlide-1].img)}),$(c.container).on("click",function(){g.nextSlide()}),$(a).on("resize",function(){g.setDimension()}),$(c.nextArrow).on("click",function(){g.nextSlide()}),$(c.prevArrow).on("click",function(){g.prevSlide()})},nextSlide:function(){c.currentSlide!=c.limit?(c.currentSlide++,$(c.container).stop(!0,!0).animate({left:"-="+c.overflow.width()}),c.stopLazy||g.renderImage(c.items[c.currentSlide-1].img)):($(c.container).stop(!0,!0).animate({left:0}),c.currentSlide=1,c.stopLazy=!0)},prevSlide:function(){1!=c.currentSlide?(c.currentSlide--,$(c.container).stop(!0,!0).animate({left:"+="+c.overflow.width()})):($(c.container).addClass("animated shake"),b(function(){$(c.container).removeClass("animated shake")},1e3),$(c.container).stop(!0,!0).animate({left:0}),c.currentSlide=1)},setDimension:function(){c.container.width(c.overflow.width()*c.items.length),c.container.css({left:-1*c.overflow.width()*(c.currentSlide-1)})},renderImage:function(a){var b='<img class="animated fadeIn" src="'+a+'"/>',d=$(e).find(".lazy-element[data-index="+(c.currentSlide-1)+"]");$(d).hasClass("loaded")||g.loadImage(b).then(function(){$(e).find(d).find(".cover").css({"background-image":"url("+a+")",display:"block"}),$(e).find(d).find("h3").css("display","block"),$(e).find(d).find(".loader").fadeOut(),$(e).find(d).addClass("loaded")},function(){$(e).find(d).append('<div class="error">Oops! Problem to loading image</div>'),$(e).find(d).find("h3").css("display","block"),$(e).find(d).find(".loader").fadeOut(),$(e).find(d).addClass("loaded error")})},loadImage:function(a){var b=d.defer();return $(a).load(function(){b.resolve("image loaded...")}).error(function(){b.reject("error loading image...")}),b.promise}};c.$on("listEnd",function(){g.init()})},templateUrl:"components/lazy-carousel/view/lazy-carousel.html"}}]).directive("lazyElement",["$window",function(a){return{scope:!0,require:"^lazyCarousel",link:function(b,c,d){b.$last===!0&&b.$emit("listEnd");var e={init:function(){e.setDimension(),$(a).on("resize",function(){e.setDimension()})},setDimension:function(){$(c).css({width:b.overflow.width(),height:b.overflow.height(),left:b.overflow.width()*d.index})},scaleImg:function(){var a=$(c).find("img"),b=$(a).height(),d=$(a).width();console.log("widthandheight:",d,b),d>b?$(a).addClass("wide-img"):$(a).addClass("tall-img")}};e.init()}}}]).factory("itemService",["$http",function(a){var b={get:function(b){return a.get(b).success(function(a){return a}).error(function(a){return a})}};return b}]);